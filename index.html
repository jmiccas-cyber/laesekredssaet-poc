<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <title>Læsekredssæt – v3.1.9B</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Calibri, sans-serif; margin:20px; background:#f8f8f8; }
    h1 { margin-bottom:4px; }
    .hidden { display:none !important; }
    nav.tabs { margin-top:20px; margin-bottom:10px; }
    nav.tabs button { padding:6px 12px; margin-right:4px; background:#eee; border:1px solid #ccc; cursor:pointer; }
    nav.tabs button.active { background:white; border-bottom:2px solid #0070f3; }
    .panel { display:none; }
    .panel.active { display:block; }
    table { border-collapse:collapse; width:100%; background:white; }
    th, td { border:1px solid #ddd; padding:6px; }
    th { background:#fafafa; text-align:left; }
    input.edit, select.edit { width:100%; box-sizing:border-box; }
    .row { display:flex; gap:20px; }
    .msg { padding:8px; margin-top:10px; border-radius:4px; }
    .msg.ok { background:#d0ffd0; border:1px solid #6b6; }
    .msg.err { background:#ffd0d0; border:1px solid #c66; }
    .btn { padding:6px 12px; cursor:pointer; border-radius:4px; }
    .btn.primary { background:#0070f3; color:white; border:none; }
    .btn.ghost { background:#eee; border:1px solid #ccc; }
    .btn.danger { background:#d9534f; color:white; border:none; }

    /* Role badge */
    #roleBadge { display:inline-block; padding:4px 8px; border-radius:4px; font-weight:bold; }
    .role-admin { background:#0070f3; color:white; }
    .role-booker { background:#28a745; color:white; }

    /* Modal */
    .modal-backdrop {
      position:fixed; left:0; top:0; right:0; bottom:0;
      background:rgba(0,0,0,0.4);
      display:none;
      justify-content:center; align-items:center;
    }
    .modal {
      background:white; padding:20px; border-radius:6px; min-width:360px;
      box-shadow:0 4px 12px rgba(0,0,0,0.25);
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="script.js"></script>
</head>

<body>

<h1>Læsekredssæt – Admin / Booker</h1>

<div>
  <span id="roleBadge" class="role-admin"><span id="roleText">Admin</span></span>
  <span id="profileText"></span>
  &nbsp;•&nbsp;
  <button id="toggleRole" class="btn ghost">Skift: Admin ↔ Booker</button>
</div>

<!-- Admin tabs -->
<nav id="adminTabs" class="tabs">
  <button data-tab="tab-eks" class="active">Eksemplarer</button>
  <button data-tab="tab-saet">Sæt</button>
  <button data-tab="tab-region">Region</button>
</nav>

<!-- ========== ADMIN: EKSEMPLARER ========== -->
<section id="tab-eks" class="panel active">
  <h2>Eksemplarer</h2>

  <div class="row">
    <div>
      <label>Booking Status</label>
      <select id="statusFilter">
        <option value="">(alle)</option>
        <option value="Ledig">Ledig</option>
        <option value="Reserveret">Reserveret</option>
        <option value="Booket">Booket</option>
      </select>
    </div>
    <div>
      <label>Søg</label>
      <input id="q" placeholder="titel, forfatter, ISBN…" />
    </div>
    <div style="align-self:flex-end;">
      <button id="btnSearch" class="btn">Søg</button>
      <button id="btnReload" class="btn">↻</button>
    </div>
    <div style="margin-left:auto; align-self:flex-end;">
      <button id="btnNew" class="btn primary">+ Ny</button>
      <button id="btnSaveAll" class="btn primary" style="margin-left:8px;">Gem alle</button>
    </div>
  </div>

  <div id="msg" class="msg" style="display:none;"></div>

  <table id="tblEks">
    <thead>
      <tr>
        <th>Stregkode</th>
        <th>Titel</th>
        <th>Forfatter</th>
        <th>ISBN</th>
        <th>FAUST</th>
        <th>Booking Status</th>
        <th>Loan Status</th>
        <th>Handling</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="margin-top:8px;">
    <button id="prev" class="btn">◀</button>
    <button id="next" class="btn">▶</button>
    <span id="pinfo"></span>
  </div>
</section>

<!-- ========== ADMIN: SÆT ========== -->
<section id="tab-saet" class="panel">
  <h2>Sæt</h2>

  <div class="row">
    <div>
      <label>Ejer</label>
      <select id="saetOwnerFilterSel"></select>
    </div>
    <div>
      <label>Synlighed</label>
      <select id="saetVisFilter">
        <option value="">(alle)</option>
        <option value="national">national</option>
        <option value="regional">regional</option>
      </select>
    </div>
    <div>
      <label>Søg</label>
      <input id="saetQ" />
    </div>
    <div style="align-self:flex-end;">
      <button id="btnSaetSearch" class="btn">Søg</button>
    </div>
    <div style="margin-left:auto; align-self:flex-end;">
      <button id="btnSaetNew" class="btn primary">+ Nyt sæt</button>
    </div>
  </div>

  <div id="msgSaet" class="msg" style="display:none;"></div>

  <table id="tblSaet">
    <thead>
      <tr>
        <th>ID</th><th>Titel</th><th>Forfatter</th><th>ISBN</th><th>FAUST</th>
        <th>Antal</th><th>Uger</th><th>Buffer</th><th>Synlighed</th><th>Ejer</th>
        <th>Aktiv</th><th>Sub</th><th>Delvis</th><th>Min</th><th>Handling</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="margin-top:8px;">
    <button id="saetPrev" class="btn">◀</button>
    <button id="saetNext" class="btn">▶</button>
    <span id="saetPinfo"></span>
  </div>
</section>

<!-- ========== ADMIN: REGION ========== -->
<section id="tab-region" class="panel">
  <h2>Region – Tilknyttede biblioteker</h2>

  <div class="row">
    <div>
      <label>Centralbibliotek</label>
      <input id="relCentralReadonly" readonly />
    </div>
    <div>
      <label>Lånerbibliotek</label>
      <select id="relLocal"></select>
    </div>
    <div style="align-self:flex-end;">
      <button id="btnRelAdd" class="btn primary">Tilføj</button>
    </div>
  </div>

  <div class="row" style="margin-top:20px;">
    <div>
      <label>Nyt lånerbibliotek – ID</label>
      <input id="newLocalId" />
    </div>
    <div>
      <label>Navn</label>
      <input id="newLocalName" />
    </div>
    <div>
      <label>Aktiv</label>
      <select id="newLocalActive">
        <option value="true">Ja</option>
        <option value="false">Nej</option>
      </select>
    </div>
    <div style="align-self:flex-end;">
      <button id="btnCreateLocal" class="btn primary">+ Opret bibliotek</button>
    </div>
  </div>

  <div id="msgRel" class="msg" style="margin-top:12px; display:none;"></div>

  <table id="tblRel" style="margin-top:20px;">
    <thead>
      <tr>
        <th>ID</th><th>Lånerbibliotek</th><th>Central</th><th>Aktiv (Relation)</th><th>Bibliotek Aktiv</th><th>Handling</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- ========== BOOKER VISNING ========== -->
<section id="bookerView" class="panel hidden">
  <h2>Booker – Søg sæt</h2>

  <div class="row">
    <div>
      <label>Periode start</label>
      <input type="date" id="bStart" />
    </div>
    <div>
      <label>Låneuger</label>
      <input type="number" id="bWeeks" value="8" />
    </div>
    <div>
      <label>Søg</label>
      <input id="bQ" placeholder="titel, forfatter…" />
    </div>
    <div style="align-self:flex-end;">
      <button id="bSearch" class="btn">Søg</button>
    </div>
  </div>

  <div id="bMsg" class="msg" style="display:none;"></div>

  <table id="bTbl" style="margin-top:12px;">
    <thead>
      <tr>
        <th>Titel</th><th>Forfatter</th><th>ISBN</th><th>FAUST</th><th>Synlighed</th><th>Ejer</th><th>Anmod</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="margin-top:8px;">
    <button id="bPrev" class="btn">◀</button>
    <button id="bNext" class="btn">▶</button>
    <span id="bInfo"></span>
  </div>
</section>

<!-- Role-change modal -->
<div id="roleModal" class="modal-backdrop">
  <div class="modal">
    <h3>Skift profil</h3>

    <div>
      <label for="roleSelect">Rolle</label>
      <select id="roleSelect">
        <option value="admin">Admin (central)</option>
        <option value="booker">Booker (låner)</option>
      </select>
    </div>

    <div id="adminProfileWrap" style="margin-top:12px;">
      <label>Centralbibliotek</label>
      <select id="adminProfileSel"></select>
    </div>

    <div id="bookerProfileWrap" style="display:none; margin-top:12px;">
      <label>Lånerbibliotek</label>
      <select id="bookerProfileSel"></select>
    </div>

    <div style="margin-top:20px; text-align:right;">
      <button id="roleCancel" class="btn ghost">Annullér</button>
      <button id="roleSave" class="btn primary">Gem profil</button>
    </div>
  </div>
</div>

</body>
</html>
